(* EXPORT START *)

fun ping_test () = let 
  val raft = raft 5 (ping_server ()) (fn log => log.entries_since_snap > 10) true 
  val pid = self ()
in 
  print "Sending";
  send (raft, ("RAFT-UPDATE",(pid, ("ping", 3))));
  print (receive [hn x => x]);
  send (raft, ("RAFT-UPDATE",(pid, ("test", 3))));
  send (raft, ("RAFT-UPDATE",(pid, ("ping", 7))));
  print (receive [hn x => x]);
  send (raft, ("SEND-TO-ALL","debug-printlog"))
end

fun ping_test2 () = let 
  val raft = raft 5 (ping_server ()) (fn log => log.entries_since_snap > 10) true 
  val pid = self ()
  fun loop x = let 
    val _ = sleep 500
    val _ = send (raft, ("RAFT-UPDATE", (pid, ("ping", x))))
    val (pong, new_x) = receive [hn (pong, x) => (pong, x)]
    val _ = print (pong, x)
  in loop new_x end
in loop 1 end
(* EXPORT END*)
